<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="category">
	<select id="selectCategory" parameterType="int" resultType="CategoryVo">
		<![CDATA[
			select  cate_no cateNo,
			         user_no userNo,
			         cate_name cateName,
			         group_no groupNo,
			         order_no orderNo,
			         depth
			from category
			order by group_no asc, order_no asc
		]]>
	</select>

	<!--상위폴더생성 -->
	<insert id="addMainFolder" parameterType="CategoryVo">
		<![CDATA[
			INSERT INTO category
			VALUES (seq_cate_no.nextval, #{userNo}, #{cateName}, seq_cate_no.nextval, 1, 0)
		]]>
	</insert>

	<!-- 하위폴더 생성 -->
	<insert id="addSubFolder" parameterType="CategoryVo">
		<![CDATA[
			INSERT INTO category
			VALUES (seq_cate_no.nextval, #{userNo}, #{cateName}, #{groupNo}, seq_order_no.nextval, 1)
		]]>
	</insert>

	<update id="updateFolder" parameterType="CategoryVo">
		<![CDATA[
			update category
			set cate_name = #{cateName}
			where cate_no = #{cateNo};
		]]>
	</update>

	<select id="selectProblem" parameterType="int" resultType="com.javaex.vo.ProblemVo">
		<![CDATA[
			select  c.cate_no cateNo,
			         p.problem_no problemNo,
			         p.problem_title problemTitle,
			         p.type type,
			         to_char(p.reg_date, 'YYYY-MM-DD') regDate
			from problem p, category c
			where p.cate_no = c.cate_no
			and p.cate_no = #{cate_no}
			order by problem_no asc
		]]>
	</select>

	<insert id="problemInsert" parameterType="ProblemVo">
		<![CDATA[
			insert into problem
			values(
			    seq_problem_no.nextval,
			    #{cateNo},
			    #{type},
			    #{problemTitle},
			    #{content},
			    #{contentImage, jdbcType=VARCHAR},
			    #{description},
			    #{answer},
			    sysdate
			)
		]]>

	</insert>

	<insert id="ChoiceInsert" parameterType="map">
		<![CDATA[
			insert into choice
			values(
			     SEQ_CHOICE.nextval,
			     seq_problem_no.currval,
			     #{choiceContent},
			     #{filepath},
			     #{orderNo}
			)
		]]>
	</insert>

	<select id="problemView" parameterType="int" resultType="com.javaex.vo.ProblemVo">
		<![CDATA[
			select type,
					problem_title problemTitle,
					content,
					content_image contentImage,
					description,
					answer
			from problem
			where problem_no = #{problemNo}
		]]>
	</select>
	
	<update id="ProblemModefy" parameterType="ProblemVo">
		<![CDATA[
			update problem
			set problem_title = #{problemTitle}
			where problem_no = #{problemNo}
		]]>
	</update>
	
</mapper>
